原文链接:[创建、索引、删除文档](https://www.elastic.co/guide/en/elasticsearch/guide/current/distrib-write.html)

注意:文档有些老了，然而最新的文档又没有这部分的原理，有些地方可能最新版的 es 已经不是这样了，不过估计大部分的原理还是没有变化的。最新版的同步应该不是立即的，而是攒够一波才同步的。

创建、索引、删除请求都是写操作，写造作必须在主分片上做，写操作必须完全成功之后才拷贝给关联的复制分片，如下图所示。

下面是成功创建、索引、删除文档后，主分片和复制分片的交互过程的顺序。
1. 客户端给 Node 1 发送了一个 create、index 或者 delete 请求。
2. Node1 节点利用了文档的 _id ，经过哈希计算后确定了这个文档属于 shard 0 。shard 0 的主分片正好在 Node 3 中，所以它把这个请求转发给了 Node 3 ， 
3. Node 3 在主分片上执行了请求。如果执行成功的话，Node 3 会并行的吧请求转发给 Node 1 和 Node 2 的复制分片上。一旦所有的复制分片报告复制成功后，Node 3 会把成功的消息报告给协调节点，协调节点然后再报告成功给客户端。

客户端接收到成功的响应之后，文档的改变已经在主分片和复制分片之间执行完了。你的变更已经安全的改变了。



